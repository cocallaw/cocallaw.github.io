<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Export BitLocker Keys from Entra with Graph PowerShell" /><meta name="author" content="Corey Callaway" /><meta property="og:locale" content="en" /><meta name="description" content="How to retrieve BitLocker recovery keys from Entra using PowerShell and Microsoft Graph." /><meta property="og:description" content="How to retrieve BitLocker recovery keys from Entra using PowerShell and Microsoft Graph." /><link rel="canonical" href="https://cocallaw.com/posts/Export-Bitlocker-Keys-from-Entra/" /><meta property="og:url" content="https://cocallaw.com/posts/Export-Bitlocker-Keys-from-Entra/" /><meta property="og:site_name" content="cocallaw" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-05-12T06:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Export BitLocker Keys from Entra with Graph PowerShell" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Corey Callaway" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Corey Callaway","url":"https://www.cocallaw.com/about/"},"dateModified":"2025-05-12T06:00:00-04:00","datePublished":"2025-05-12T06:00:00-04:00","description":"How to retrieve BitLocker recovery keys from Entra using PowerShell and Microsoft Graph.","headline":"Export BitLocker Keys from Entra with Graph PowerShell","mainEntityOfPage":{"@type":"WebPage","@id":"https://cocallaw.com/posts/Export-Bitlocker-Keys-from-Entra/"},"url":"https://cocallaw.com/posts/Export-Bitlocker-Keys-from-Entra/"}</script><title>Export BitLocker Keys from Entra with Graph PowerShell | cocallaw</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "b814618bb529402badb6aeea52009c22"}' ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://ccblog-hxegfte6cpg4c7a3.z01.azurefd.net/general/profile.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">cocallaw</a><p class="site-subtitle fst-italic mb-0">Tech Tinkerings</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/cocallaw" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/corey-callaway-1abbb227/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Export BitLocker Keys from Entra with Graph PowerShell</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Export BitLocker Keys from Entra with Graph PowerShell</h1><p class="post-desc fw-light mb-4">How to retrieve BitLocker recovery keys from Entra using PowerShell and Microsoft Graph.</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1747044000" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 12, 2025 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.cocallaw.com/about/">Corey Callaway</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1206 words" > <em>6 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Export BitLocker Keys from Entra with Graph PowerShell</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Export BitLocker Keys from Entra with Graph PowerShell</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>On the day of the <a href="https://en.wikipedia.org/wiki/2024_CrowdStrike-related_IT_outages">CrowdStrike outage</a>, countless Windows devices across the world became unstable—many of them failing to boot or respond. For some machines administrators needed one critical thing to be able to access the disk and attempt repair: the BitLocker recovery key.</p><p>If the Windows machine was registered with Intune/Entra, these recovery keys were likely stored securely in your tenant. Working with different customers and the help of PowerShell and Microsoft Graph, a script was created over that weekend that was able to retrieve BitLocker Keys quickly and at scale so that they could be provided to whatever the next step was in the recovery process.</p><p>The Script: <a href="https://github.com/cocallaw/Entra-Get-BLKeys">cocallaw/Entra-Get-BLKeys</a></p><hr /><h2 id="the-problem"><span class="me-2">The Problem</span><a href="#the-problem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Windows machines were unable to boot due to a bad kernel driver.<li>To recovery, admins needed to access the disk and remove the problematic driver.<li>If BitLocker encryption was enabled on the OS disk, the machine would require a recovery key to unlock the drive.<li>Admins needed the recovery keys for numerous machines, but they were not easily accessible at scale.</ul><hr /><h2 id="the-solution-powershell--microsoft-graph"><span class="me-2">The Solution: PowerShell + Microsoft Graph</span><a href="#the-solution-powershell--microsoft-graph" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The following PowerShell script automates the retrieval of BitLocker recovery keys for a list of machine names. It queries Microsoft Graph to find devices by name, then pulls their associated keys.</p><h3 id="pre-req"><span class="me-2">Pre-req:</span><a href="#pre-req" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>The machine must be enrolled in Intune/Entra<li>The account connecting must have <code class="language-plaintext highlighter-rouge">Device.Read.All</code> and <code class="language-plaintext highlighter-rouge">BitLockerKey.Read.All</code> permissions in Microsoft Graph.<li>A CSV file with the one column named <code class="language-plaintext highlighter-rouge">MachineName</code> and the names of machines in the column.</ul><hr /><h2 id="running-the-script"><span class="me-2">Running the Script</span><a href="#running-the-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>Save the script as <code class="language-plaintext highlighter-rouge">Get-BitLockerKeys.ps1</code>.<li>Open PowerShell and run the script with the path to your CSV file as the parameter <code class="language-plaintext highlighter-rouge">-MachinesCSV</code>.<li>The script will output a CSV file named <code class="language-plaintext highlighter-rouge">DeviceRecoveryKeys.csv</code>.</ol><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">.</span><span class="n">\Get-BitLockerKeys.ps1</span><span class="w"> </span><span class="nt">-MachinesCSV</span><span class="w"> </span><span class="s2">"C:\path\to\your\machines.csv"</span><span class="w">
</span></pre></table></code></div></div><hr /><h2 id="section-1-input-validation"><span class="me-2">Section 1: Input Validation</span><a href="#section-1-input-validation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The first part ensures that the file provided by the <code class="language-plaintext highlighter-rouge">MachinesCSV</code> parameter exists, is a <code class="language-plaintext highlighter-rouge">.csv</code>, and contains the expected header.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kr">Param</span><span class="w"> </span><span class="p">(</span><span class="w">
    </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$MachinesCSV</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$MachinesCSV</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"The file '</span><span class="nv">$MachinesCSV</span><span class="s2">' does not exist. Please provide a valid file path."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="nv">$MachinesCSV</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*.csv"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"The file '</span><span class="nv">$MachinesCSV</span><span class="s2">' is not a CSV file."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$csvContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Import-Csv</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$MachinesCSV</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$csvContent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nf">PSObject</span><span class="o">.</span><span class="nf">Properties</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="s2">"MachineName"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"The CSV must contain a 'MachineName' column."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h2 id="section-2-module-check--authentication"><span class="me-2">Section 2: Module Check &amp; Authentication</span><a href="#section-2-module-check--authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This section checks that the Microsoft Graph module is available and current, then connects with the appropriate scopes.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nv">$module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Module</span><span class="w"> </span><span class="nt">-ListAvailable</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Microsoft.Graph</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$module</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Microsoft Graph PowerShell module is not installed."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$module</span><span class="o">.</span><span class="nf">Version</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="p">[</span><span class="n">Version</span><span class="p">]</span><span class="s2">"2.5.0"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Please update the Microsoft Graph module."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="s2">"Device.Read.All"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BitLockerKey.Read.All"</span><span class="w"> </span><span class="nt">-NoWelcome</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Failed to connect to Microsoft Graph."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">Import-Module</span><span class="w"> </span><span class="nx">Microsoft.Graph.Identity.DirectoryManagement</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
</span></pre></table></code></div></div><hr /><h2 id="section-3-device-lookup"><span class="me-2">Section 3: Device Lookup</span><a href="#section-3-device-lookup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Once connected this part queries Microsoft Graph to find matching device records by names as listed in the CSV file provided.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$vmNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Import-Csv</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$MachinesCSV</span><span class="p">)</span><span class="o">.</span><span class="nf">MachineName</span><span class="w">
</span><span class="nv">$devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">

</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$vmName</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$vmNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$devices</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Get-MgDevice</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s2">"displayName eq '</span><span class="nv">$vmName</span><span class="s2">'"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h2 id="section-4-retrieve-bitlocker-keys"><span class="me-2">Section 4: Retrieve BitLocker Keys</span><a href="#section-4-retrieve-bitlocker-keys" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>With the list of machines stored in <code class="language-plaintext highlighter-rouge">$devices</code>, we pull recovery keys per device and if no recovery key info is found set <code class="language-plaintext highlighter-rouge">NoKeyFound</code> as the value for the Recovery Key and ID.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nv">$deviceRecoveryKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">

</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$device</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$recoveryKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgInformationProtectionBitlockerRecoveryKey</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s2">"deviceId eq '</span><span class="si">$(</span><span class="nv">$device</span><span class="o">.</span><span class="nf">DeviceId</span><span class="si">)</span><span class="s2">'"</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$recoveryKeys</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$key</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$recoveryKeys</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$deviceRecoveryKeys</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">[</span><span class="n">PSCustomObject</span><span class="p">]@{</span><span class="w">
                </span><span class="nx">DeviceName</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">$device</span><span class="err">.</span><span class="nx">DisplayName</span><span class="w">
                </span><span class="nx">DeviceId</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">$device</span><span class="err">.</span><span class="nx">DeviceId</span><span class="w">
                </span><span class="nx">RecoveryKeyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$key</span><span class="err">.</span><span class="nx">Id</span><span class="w">
                </span><span class="nx">RecoveryKey</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="err">(</span><span class="nx">Get</span><span class="err">-</span><span class="nx">MgInformationProtectionBitlockerRecoveryKey</span><span class="w"> </span><span class="err">-</span><span class="nx">BitlockerRecoveryKeyId</span><span class="w"> </span><span class="nv">$key</span><span class="err">.</span><span class="nx">Id</span><span class="w"> </span><span class="err">-</span><span class="nx">Property</span><span class="w"> </span><span class="nx">key</span><span class="err">).</span><span class="nx">key</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$deviceRecoveryKeys</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">[</span><span class="n">PSCustomObject</span><span class="p">]@{</span><span class="w">
            </span><span class="nx">DeviceName</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">$device</span><span class="err">.</span><span class="nx">DisplayName</span><span class="w">
            </span><span class="nx">DeviceId</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">$device</span><span class="err">.</span><span class="nx">DeviceId</span><span class="w">
            </span><span class="nx">RecoveryKeyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"NoKeyFound"</span><span class="w">
            </span><span class="nx">RecoveryKey</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"NoKeyFound"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><hr /><h2 id="section-5-export-to-csv"><span class="me-2">Section 5: Export to CSV</span><a href="#section-5-export-to-csv" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Finally, the key information is output to a CSV file named <code class="language-plaintext highlighter-rouge">DeviceRecoveryKeys.csv</code> and displays the path.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$outputFilePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DeviceRecoveryKeys.csv"</span><span class="w">
</span><span class="nv">$deviceRecoveryKeys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Export-Csv</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$outputFilePath</span><span class="w"> </span><span class="nt">-NoTypeInformation</span><span class="w">

</span><span class="nv">$absolutePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Resolve-Path</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$outputFilePath</span><span class="w">
</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Device recovery keys have been exported to '</span><span class="nv">$absolutePath</span><span class="s2">'."</span><span class="w">
</span></pre></table></code></div></div><h2 id="section-6-sample-output"><span class="me-2">Section 6: Sample Output</span><a href="#section-6-sample-output" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The output CSV <code class="language-plaintext highlighter-rouge">DeviceRecoveryKeys.csv</code> will follow this format:</p><pre><code class="language-csv">"DeviceName","DeviceId","RecoveryKeyId","RecoveryKey"
"test-vm-0","90e61314-d6dd-4ff8-a878-754b5b60a8be","11135913-8395-458b-a7bf-dd7ef10214a2","375177-019569-186362-280841-610973-240801-321277-046255"
"test-vm-1","c7165ba4-0fac-4ec5-82bf-5e4ff05dcdc8","NoKeyFound","NoKeyFound"
</code></pre><hr /><h2 id="full-script"><span class="me-2">Full Script</span><a href="#full-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>For easy copy/pasting, the entire script is below in one block. You can also find it in the GitHub Repo <a href="https://github.com/cocallaw/Entra-Get-BLKeys">cocallaw/Entra-Get-BLKeys</a>.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre><td class="rouge-code"><pre><span class="kr">Param</span><span class="w"> </span><span class="p">(</span><span class="w">
    </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$MachinesCSV</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$MachinesCSV</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"The file '</span><span class="nv">$MachinesCSV</span><span class="s2">' does not exist. Please provide a valid file path."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="nv">$MachinesCSV</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*.csv"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"The file '</span><span class="nv">$MachinesCSV</span><span class="s2">' is not a CSV file."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$csvContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Import-Csv</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$MachinesCSV</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$csvContent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nf">PSObject</span><span class="o">.</span><span class="nf">Properties</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="s2">"MachineName"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"The CSV must contain a 'MachineName' column."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Module</span><span class="w"> </span><span class="nt">-ListAvailable</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Microsoft.Graph</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$module</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Microsoft Graph PowerShell module is not installed."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$module</span><span class="o">.</span><span class="nf">Version</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="p">[</span><span class="n">Version</span><span class="p">]</span><span class="s2">"2.5.0"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Please update the Microsoft Graph module."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="s2">"Device.Read.All"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BitLockerKey.Read.All"</span><span class="w"> </span><span class="nt">-NoWelcome</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Failed to connect to Microsoft Graph."</span><span class="w">
    </span><span class="kr">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">Import-Module</span><span class="w"> </span><span class="nx">Microsoft.Graph.Identity.DirectoryManagement</span><span class="w"> </span><span class="nt">-Force</span><span class="w">

</span><span class="nv">$vmNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Import-Csv</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$MachinesCSV</span><span class="p">)</span><span class="o">.</span><span class="nf">MachineName</span><span class="w">
</span><span class="nv">$devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">

</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$vmName</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$vmNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$devices</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Get-MgDevice</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s2">"displayName eq '</span><span class="nv">$vmName</span><span class="s2">'"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$deviceRecoveryKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">

</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$device</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$recoveryKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MgInformationProtectionBitlockerRecoveryKey</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="s2">"deviceId eq '</span><span class="si">$(</span><span class="nv">$device</span><span class="o">.</span><span class="nf">DeviceId</span><span class="si">)</span><span class="s2">'"</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$recoveryKeys</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$key</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$recoveryKeys</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$deviceRecoveryKeys</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">[</span><span class="n">PSCustomObject</span><span class="p">]@{</span><span class="w">
                </span><span class="nx">DeviceName</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">$device</span><span class="err">.</span><span class="nx">DisplayName</span><span class="w">
                </span><span class="nx">DeviceId</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">$device</span><span class="err">.</span><span class="nx">DeviceId</span><span class="w">
                </span><span class="nx">RecoveryKeyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$key</span><span class="err">.</span><span class="nx">Id</span><span class="w">
                </span><span class="nx">RecoveryKey</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="err">(</span><span class="nx">Get</span><span class="err">-</span><span class="nx">MgInformationProtectionBitlockerRecoveryKey</span><span class="w"> </span><span class="err">-</span><span class="nx">BitlockerRecoveryKeyId</span><span class="w"> </span><span class="nv">$key</span><span class="err">.</span><span class="nx">Id</span><span class="w"> </span><span class="err">-</span><span class="nx">Property</span><span class="w"> </span><span class="nx">key</span><span class="err">).</span><span class="nx">key</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$deviceRecoveryKeys</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">[</span><span class="n">PSCustomObject</span><span class="p">]@{</span><span class="w">
            </span><span class="nx">DeviceName</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">$device</span><span class="err">.</span><span class="nx">DisplayName</span><span class="w">
            </span><span class="nx">DeviceId</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">$device</span><span class="err">.</span><span class="nx">DeviceId</span><span class="w">
            </span><span class="nx">RecoveryKeyId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"NoKeyFound"</span><span class="w">
            </span><span class="nx">RecoveryKey</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"NoKeyFound"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$outputFilePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DeviceRecoveryKeys.csv"</span><span class="w">
</span><span class="nv">$deviceRecoveryKeys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Export-Csv</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$outputFilePath</span><span class="w"> </span><span class="nt">-NoTypeInformation</span><span class="w">
</span><span class="nv">$absolutePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Resolve-Path</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$outputFilePath</span><span class="w">
</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Device recovery keys have been exported to '</span><span class="nv">$absolutePath</span><span class="s2">'."</span><span class="w">
</span></pre></table></code></div></div><hr /><h2 id="permissions-reminder"><span class="me-2">Permissions Reminder</span><a href="#permissions-reminder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This script requires delegated or app permissions for:</p><ul><li><code class="language-plaintext highlighter-rouge">Device.Read.All</code><li><code class="language-plaintext highlighter-rouge">BitLockerKey.Read.All</code></ul><hr /><h2 id="notes"><span class="me-2">Notes</span><a href="#notes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Recovery keys are only available if the device was properly enrolled and reporting compliance.<li>Permissions must be delegated or granted to the appropriate Graph scopes<li>The script exports the keys in plaintext, be cautious with the output file or update the script to output in a more secure manner<li>This script is designed for educational purposes and should be tested in a safe environment before use in production.</ul><h2 id="final-thoughts"><span class="me-2">Final Thoughts</span><a href="#final-thoughts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This was a good reminder that recovery isn’t just about backups—it’s also about access. PowerShell and Microsoft Graph made it possible to recover quickly during the CrowdStrike outage by tapping into the organization’s existing processes and tooling.</p><p>The script is a great example of how to leverage existing tools to solve real-world problems. If you have any questions or need help with the script, feel free to reach out.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/powershell/">PowerShell</a>, <a href="/categories/azure/">Azure</a>, <a href="/categories/microsoft-graph/">Microsoft Graph</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/powershell/" class="post-tag no-text-decoration" >PowerShell</a> <a href="/tags/crowdstrike/" class="post-tag no-text-decoration" >CrowdStrike</a> <a href="/tags/bitlocker/" class="post-tag no-text-decoration" >BitLocker</a> <a href="/tags/entra/" class="post-tag no-text-decoration" >Entra</a> <a href="/tags/microsoft-graph/" class="post-tag no-text-decoration" >Microsoft Graph</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fcocallaw.com%2Fposts%2FExport-Bitlocker-Keys-from-Entra%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fcocallaw.com%2Fposts%2FExport-Bitlocker-Keys-from-Entra%2F&title=Export%20BitLocker%20Keys%20from%20Entra%20with%20Graph%20PowerShell%20-%20cocallaw" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Reddit" aria-label="Reddit"> <i class="fa-fw fa-brands fa-square-reddit"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Export%20BitLocker%20Keys%20from%20Entra%20with%20Graph%20PowerShell%20-%20cocallaw&u=https%3A%2F%2Fcocallaw.com%2Fposts%2FExport-Bitlocker-Keys-from-Entra%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.threads.net/intent/post?text=Export%20BitLocker%20Keys%20from%20Entra%20with%20Graph%20PowerShell%20-%20cocallaw%20https%3A%2F%2Fcocallaw.com%2Fposts%2FExport-Bitlocker-Keys-from-Entra%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Threads" aria-label="Threads"> <i class="fa-fw fa-brands fa-square-threads"></i> </a> <a href="https://bsky.app/intent/compose?text=Export%20BitLocker%20Keys%20from%20Entra%20with%20Graph%20PowerShell%20-%20cocallaw%20https%3A%2F%2Fcocallaw.com%2Fposts%2FExport-Bitlocker-Keys-from-Entra%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Bluesky" aria-label="Bluesky"> <i class="fa-fw fa-brands fa-bluesky"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/Proactively-monitor-Azure-retirements-AzRetirementMonitor/">Proactively Monitor Azure Service Retirements with AzRetirementMonitor</a><li class="text-truncate lh-lg"> <a href="/posts/Azure-Auth-on-Windows/">Streamlining Azure CLI & PowerShell Authentication on Windows 11</a><li class="text-truncate lh-lg"> <a href="/posts/Automating-Lets-Encrypt-SSL-Certificates-on-Synology/">Automating Let's Encrypt SSL Certificates on Synology DSM with acme.sh and Cloudflare DNS</a><li class="text-truncate lh-lg"> <a href="/posts/Deploying-AVD-with-Bicep/">Deploying AVD and retrieving the Registration Token with Bicep</a><li class="text-truncate lh-lg"> <a href="/posts/Identify-Legacy-AAD-PS-Users/">Identify AzureAD PowerShell Users in your Tenant before Retirement</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/powershell/">PowerShell</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">Automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/devops/">DevOps</a> <a class="post-tag btn btn-outline-primary" href="/tags/entra/">Entra</a> <a class="post-tag btn btn-outline-primary" href="/tags/images/">images</a> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft-graph/">Microsoft Graph</a> <a class="post-tag btn btn-outline-primary" href="/tags/acme-sh/">acme.sh</a> <a class="post-tag btn btn-outline-primary" href="/tags/authentication/">Authentication</a> <a class="post-tag btn btn-outline-primary" href="/tags/avd/">AVD</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure-virtual-desktop/">Azure Virtual Desktop</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/Identify-Legacy-AAD-PS-Users/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1748365200" data-df="ll" > May 27, 2025 </time><h4 class="pt-0 my-2">Identify AzureAD PowerShell Users in your Tenant before Retirement</h4><div class="text-muted"><p>Microsoft is retiring the legacy AzureAD and MSOnline PowerShell modules. These modules have been widely used for years to manage users, groups, roles, and other directory objects in Azure Active D...</p></div></div></a></article><article class="col"> <a href="/posts/Proactively-monitor-Azure-retirements-AzRetirementMonitor/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1768323600" data-df="ll" > Jan 13, 2026 </time><h4 class="pt-0 my-2">Proactively Monitor Azure Service Retirements with AzRetirementMonitor</h4><div class="text-muted"><p>Learn how to proactively monitor Azure service retirements across multiple subscriptions using the AzRetirementMonitor PowerShell module, helping you avoid disruptions and maintain compliance.</p></div></div></a></article><article class="col"> <a href="/posts/Azure-Auth-on-Windows/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1768064400" data-df="ll" > Jan 10, 2026 </time><h4 class="pt-0 my-2">Streamlining Azure CLI & PowerShell Authentication on Windows 11</h4><div class="text-muted"><p>Set up a secure and convenient Azure authentication workflow on a Windows 11 machine using Windows Credential Manager and PowerShell profiles.</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/Automating-Container-Builds-for-Upstream-Changes/" class="btn btn-outline-primary" aria-label="Older" ><p>Automating Container Builds with GitHub Actions for Upstream Changes</p></a> <a href="/posts/Identify-Legacy-AAD-PS-Users/" class="btn btn-outline-primary" aria-label="Newer" ><p>Identify AzureAD PowerShell Users in your Tenant before Retirement</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2026</time> <a href="https://github.com/cocallaw">Corey Callaway</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/powershell/">PowerShell</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">Automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/devops/">DevOps</a> <a class="post-tag btn btn-outline-primary" href="/tags/entra/">Entra</a> <a class="post-tag btn btn-outline-primary" href="/tags/images/">images</a> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft-graph/">Microsoft Graph</a> <a class="post-tag btn btn-outline-primary" href="/tags/acme-sh/">acme.sh</a> <a class="post-tag btn btn-outline-primary" href="/tags/authentication/">Authentication</a> <a class="post-tag btn btn-outline-primary" href="/tags/avd/">AVD</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure-virtual-desktop/">Azure Virtual Desktop</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'cocallaw/cocallaw.github.io', 'data-repo-id': 'R_kgDOMuW1lg', 'data-category': 'Giscus', 'data-category-id': 'DIC_kwDOMuW1ls4CjqPh', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
