<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Identify AzureAD PowerShell Users in your Tenant before Retirement" /><meta name="author" content="Corey Callaway" /><meta property="og:locale" content="en" /><meta name="description" content="Microsoft is retiring the legacy AzureAD and MSOnline PowerShell modules. These modules have been widely used for years to manage users, groups, roles, and other directory objects in Azure Active Directory (now Entra ID). With their deprecation, it’s critical to identify any users or automation that still rely on them — and plan a migration." /><meta property="og:description" content="Microsoft is retiring the legacy AzureAD and MSOnline PowerShell modules. These modules have been widely used for years to manage users, groups, roles, and other directory objects in Azure Active Directory (now Entra ID). With their deprecation, it’s critical to identify any users or automation that still rely on them — and plan a migration." /><link rel="canonical" href="https://cocallaw.com/posts/Identify-Legacy-AAD-PS-Users/" /><meta property="og:url" content="https://cocallaw.com/posts/Identify-Legacy-AAD-PS-Users/" /><meta property="og:site_name" content="cocallaw" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-05-27T13:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Identify AzureAD PowerShell Users in your Tenant before Retirement" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Corey Callaway" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Corey Callaway","url":"https://www.cocallaw.com/about/"},"dateModified":"2025-05-27T13:00:00-04:00","datePublished":"2025-05-27T13:00:00-04:00","description":"Microsoft is retiring the legacy AzureAD and MSOnline PowerShell modules. These modules have been widely used for years to manage users, groups, roles, and other directory objects in Azure Active Directory (now Entra ID). With their deprecation, it’s critical to identify any users or automation that still rely on them — and plan a migration.","headline":"Identify AzureAD PowerShell Users in your Tenant before Retirement","mainEntityOfPage":{"@type":"WebPage","@id":"https://cocallaw.com/posts/Identify-Legacy-AAD-PS-Users/"},"url":"https://cocallaw.com/posts/Identify-Legacy-AAD-PS-Users/"}</script><title>Identify AzureAD PowerShell Users in your Tenant before Retirement | cocallaw</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="cocallaw"><meta name="application-name" content="cocallaw"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "b814618bb529402badb6aeea52009c22"}' ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://ccblog-hxegfte6cpg4c7a3.z01.azurefd.net/general/profile.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">cocallaw</a><p class="site-subtitle fst-italic mb-0">Azure Tinkerings</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/cocallaw" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/corey-callaway-1abbb227/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Identify AzureAD PowerShell Users in your Tenant before Retirement</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Identify AzureAD PowerShell Users in your Tenant before Retirement</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1748365200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 27, 2025 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://www.cocallaw.com/about/">Corey Callaway</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2885 words" > <em>16 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Identify AzureAD PowerShell Users in your Tenant before Retirement</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Identify AzureAD PowerShell Users in your Tenant before Retirement</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>Microsoft is retiring the legacy <strong>AzureAD</strong> and <strong>MSOnline</strong> PowerShell modules. These modules have been widely used for years to manage users, groups, roles, and other directory objects in Azure Active Directory (now Entra ID). With their deprecation, it’s critical to identify any users or automation that still rely on them — and plan a migration.</p><p>In this post, I’ll walk you through how to:</p><ul><li>Identify sign-ins using the AzureAD PowerShell App ID with Kusto Query Language (KQL)<li>Use a PowerShell script to query sign-in logs and generate reports<li>Export and report this data via PowerShell in CSV and HTML formats</ul><h2 id="whats-being-retired"><span class="me-2">What’s Being Retired?</span><a href="#whats-being-retired" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The following modules are being deprecated:</p><ul><li><code class="language-plaintext highlighter-rouge">AzureAD</code> (<code class="language-plaintext highlighter-rouge">AzureAD.Standard.Preview</code> as well)<li><code class="language-plaintext highlighter-rouge">MSOnline</code></ul><p>These modules authenticate using the app registration (<code class="language-plaintext highlighter-rouge">1b730954-1685-4b74-9bfd-dac224a7b894</code>) that shows up in sign-in logs. Depending on the use case, customers can use either <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/overview?view=graph-powershell-1.0">Microsoft Graph PowerShell</a> or <a href="https://learn.microsoft.com/en-us/powershell/entra-powershell/overview?view=entra-powershell">Microsoft Entra PowerShell</a> replacement.</p><h2 id="option-1-find-azuread-powershell-sign-in-activity-with-kql"><span class="me-2">Option 1: Find AzureAD PowerShell Sign-In Activity with KQL</span><a href="#option-1-find-azuread-powershell-sign-in-activity-with-kql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You can use Kusto Query Language (KQL) to identify sign-ins tied to the legacy AzureAD app in your Entra ID tenant. This is useful for quickly finding users or scripts that still rely on the AzureAD PowerShell module.</p><p>If you have your sign-in logs being sent to a <strong>Log Analytics Workspace</strong> or <strong>Microsoft Sentinel</strong> you can use this Kusto query as a starting point to filter sign-in logs for the AzureAD PowerShell app ID and return relevant details.</p><h3 id="kql-query"><span class="me-2">KQL Query</span><a href="#kql-query" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">SigninLogs</span>
<span class="o">|</span> <span class="k">where</span> <span class="n">AppId</span> <span class="o">==</span> <span class="nv">"1b730954-1685-4b74-9bfd-dac224a7b894"</span> <span class="o">//</span> <span class="n">AzureAD</span> <span class="n">PowerShell</span> <span class="n">app</span> <span class="n">ID</span>
<span class="o">|</span> <span class="n">project</span> <span class="n">UserPrincipalName</span><span class="p">,</span> <span class="n">IPAddress</span><span class="p">,</span> <span class="n">ResourceDisplayName</span><span class="p">,</span> <span class="n">AuthenticationRequirement</span><span class="p">,</span> <span class="n">ConditionalAccessStatus</span><span class="p">,</span> <span class="n">Status</span><span class="p">,</span> <span class="n">CreatedDateTime</span>
<span class="o">|</span> <span class="k">order</span> <span class="k">by</span> <span class="n">CreatedDateTime</span> <span class="k">desc</span>
</pre></table></code></div></div><h2 id="option-2-use-a-powershell-script-to-query-logs-and-generate-reports"><span class="me-2">Option 2: Use a PowerShell Script to Query Logs and Generate Reports</span><a href="#option-2-use-a-powershell-script-to-query-logs-and-generate-reports" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you prefer a more automated approach, you can use a PowerShell script to query the sign-in logs for the AzureAD PowerShell app and generate reports in both CSV and HTML formats. This script will help you identify users that still rely on the legacy AzureAD module and easily filter.</p><p>The full script is available on GitHub at <a href="https://github.com/cocallaw/Entra-AAD-PS-Retirement/">cocallaw/Entra-AAD-PS-Retirement</a></p><h3 id="prerequisites"><span class="me-2">Prerequisites</span><a href="#prerequisites" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="powershell-core"><span class="me-2">PowerShell Core</span><a href="#powershell-core" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Ensure you have PowerShell Core installed on your machine. This script is designed to run on <a href="https://learn.microsoft.com/powershell/scripting/install/installing-powershell">PowerShell Core (7.x)</a> for cross-platform compatibility. This script has been tested on Windows and MacOS only.</p><h4 id="microsoft-graph-powershell"><span class="me-2">Microsoft Graph PowerShell</span><a href="#microsoft-graph-powershell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This script utilizes the <a href="https://learn.microsoft.com/powershell/microsoftgraph/installation">Microsoft Graph PowerShell SDK</a> in order to retrieve logs from the tenant. If you haven’t done so already, install it using the following command:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Install-Module</span><span class="w"> </span><span class="nx">Microsoft.Graph</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">CurrentUser</span><span class="w">
</span></pre></table></code></div></div><h4 id="permissions"><span class="me-2">Permissions</span><a href="#permissions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Ensure you have the following permissions granted to your account to run the script:</p><ul><li><code class="language-plaintext highlighter-rouge">AuditLog.Read.All</code><li><code class="language-plaintext highlighter-rouge">Directory.Read.All</code><li><code class="language-plaintext highlighter-rouge">IdentityRiskEvent.Read.All</code></ul><h3 id="what-the-script-does"><span class="me-2">What the Script Does</span><a href="#what-the-script-does" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This script connects to Microsoft Graph, retrieves sign-in logs for the AzureAD PowerShell app, and correlates them with identity risk events. It then generates a report in both CSV and HTML formats for easy review.</p><h4 id="sample-output"><span class="me-2">Sample Output</span><a href="#sample-output" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h4 id="csv-report"><span class="me-2">CSV Report</span><a href="#csv-report" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The script generates a CSV file with the following format:</p><pre><code class="language-csv">"UserPrincipalName","AppDisplayName","IPAddress","Location","SignInTime","Status","RiskLevel","CorrelationId"
"jane.doe@contoso.com","Azure Active Directory PowerShell","2605:&lt;IPV6-Address&gt;:40bd","Charlotte, North Carolina, US","5/26/2025 8:46:59 PM","Success","none","0d3b4be7-ce67-4adf-a8c7-506078f9a013"
"john.doe@contoso.com","Azure Active Directory PowerShell","XXX.YYY.ZZZ.VVV","Charlotte, North Carolina, US","5/26/2025 8:15:56 PM","Success","none","932246df-d54b-4b4d-94ec-d29427766b11"
"john.doe@contoso.com","Azure Active Directory PowerShell","XXX.YYY.ZZZ.VVV","Charlotte, North Carolina, US","5/26/2025 8:15:24 PM","Success","none","a9f18460-db0a-4ab6-8d6b-cc0f8c468a5a"
"john.doe@contoso.com","Azure Active Directory PowerShell","XXX.YYY.ZZZ.VVV","Charlotte, North Carolina, US","5/20/2025 5:34:50 PM","Success","none","279e3fe5-34ca-4bbf-a208-906d8f25c90c"
</code></pre><h4 id="html-report"><span class="me-2">HTML Report</span><a href="#html-report" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The script generates an interactive HTML report with sortable columns, which can be opened in any web browser. The HTML report includes the same data as the CSV but is formatted for easier viewing and analysis.</p><p><a href="https://ccblog-hxegfte6cpg4c7a3.z01.azurefd.net/post-content/05-aadpsrpttool/sample-html-report.png" class="popup img-link shimmer"><img src="https://ccblog-hxegfte6cpg4c7a3.z01.azurefd.net/post-content/05-aadpsrpttool/sample-html-report.png" alt="Sample-HTML-Report" loading="lazy"></a></p><h4 id="key-components"><span class="me-2">Key Components</span><a href="#key-components" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><h5 id="prerequisites--authentication"><span class="me-2"><strong>Prerequisites &amp; Authentication</strong></span><a href="#prerequisites--authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>Validates Microsoft Graph PowerShell module is installed and loaded<li>Connects to Microsoft Graph with required permissions<li><p>Handles existing connections intelligently</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="w"> </span><span class="c"># Check if Microsoft Graph commands are available</span><span class="w">
 </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Command</span><span class="w"> </span><span class="nx">Get-MgContext</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="c"># Only then check if module is installed</span><span class="w">
     </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Module</span><span class="w"> </span><span class="nt">-ListAvailable</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Microsoft.Graph</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nv">$WarningPreference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Continue'</span><span class="w"> 
         </span><span class="n">Write-Warning</span><span class="w"> </span><span class="s2">"Microsoft.Graph module is not installed. Please install it using: Install-Module Microsoft.Graph -Scope CurrentUser"</span><span class="w">
         </span><span class="kr">exit</span><span class="w">
     </span><span class="p">}</span><span class="w">
     </span><span class="c"># Try to load the module silently</span><span class="w">
     </span><span class="n">Import-Module</span><span class="w"> </span><span class="nx">Microsoft.Graph.Authentication</span><span class="w"> </span><span class="nt">-DisableNameChecking</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
 </span><span class="p">}</span><span class="w">
   
 </span><span class="c"># Connect with required permissions</span><span class="w">
 </span><span class="nv">$requiredScopes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="s2">"AuditLog.Read.All"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Directory.Read.All"</span><span class="p">,</span><span class="w"> </span><span class="s2">"IdentityRiskEvent.Read.All"</span><span class="p">)</span><span class="w">
 </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Get-MgContext</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="nv">$requiredScopes</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div></ul><h5 id="date-range-input"><span class="me-2"><strong>Date Range Input</strong></span><a href="#date-range-input" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>Prompts user for start and end dates, defaulting to the last 30 days<li><p>Converts dates to proper format for Graph API queries</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="w">  </span><span class="kr">function</span><span class="w"> </span><span class="nf">Get-ValidatedDate</span><span class="p">(</span><span class="nv">$prompt</span><span class="p">,</span><span class="w"> </span><span class="nv">$default</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="kr">do</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nv">$inDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="nv">$prompt</span><span class="w">
      </span><span class="kr">if</span><span class="w"> </span><span class="p">([</span><span class="n">string</span><span class="p">]::</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="nv">$inDate</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="nv">$default</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="nv">$parsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="w">
      </span><span class="nv">$valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">datetime</span><span class="p">]::</span><span class="n">TryParseExact</span><span class="p">(</span><span class="nv">$inDate</span><span class="p">,</span><span class="w"> </span><span class="s1">'yyyy-MM-dd'</span><span class="p">,</span><span class="w"> </span><span class="bp">$null</span><span class="p">,</span><span class="w"> </span><span class="s1">'None'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">ref</span><span class="p">]</span><span class="nv">$parsed</span><span class="p">)</span><span class="w">
      </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$valid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="nv">$parsed</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="n">Write-Warning</span><span class="w"> </span><span class="s2">"Invalid date format. Please use yyyy-MM-dd."</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="bp">$true</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
    
  </span><span class="c"># Prompt date range, defaulting to 30 days</span><span class="w">
  </span><span class="nv">$startDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ValidatedDate</span><span class="w"> </span><span class="s2">"Enter start date (yyyy-MM-dd), or press Enter for 30 days ago"</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Date</span><span class="p">)</span><span class="o">.</span><span class="nf">AddDays</span><span class="p">(</span><span class="nt">-30</span><span class="p">)</span><span class="w">
  </span><span class="nv">$endDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ValidatedDate</span><span class="w"> </span><span class="s2">"Enter end date (yyyy-MM-dd), or press Enter for today"</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Date</span><span class="p">)</span><span class="w">
    
  </span><span class="c"># Format dates for Graph API</span><span class="w">
  </span><span class="nv">$startDateUTC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">datetime</span><span class="p">]::</span><span class="n">Parse</span><span class="p">(</span><span class="nv">$startDate</span><span class="p">)</span><span class="o">.</span><span class="nf">ToUniversalTime</span><span class="p">()</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s2">"yyyy-MM-ddTHH:mm:ssZ"</span><span class="p">)</span><span class="w">
  </span><span class="nv">$endDateUTC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">([</span><span class="n">datetime</span><span class="p">]::</span><span class="n">Parse</span><span class="p">(</span><span class="nv">$endDate</span><span class="p">)</span><span class="o">.</span><span class="nf">AddDays</span><span class="p">(</span><span class="nx">1</span><span class="p">)</span><span class="o">.</span><span class="nf">AddSeconds</span><span class="p">(</span><span class="nt">-1</span><span class="p">))</span><span class="o">.</span><span class="nf">ToUniversalTime</span><span class="p">()</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s2">"yyyy-MM-ddTHH:mm:ssZ"</span><span class="p">)</span><span class="w">
</span></pre></table></code></div></div></ul><h5 id="date-collection"><span class="me-2"><strong>Date Collection</strong></span><a href="#date-collection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>Queries Microsoft Graph API for sign-in logs with the AzureAD PowerShell AppID<li><p>Handles pagination for large result sets</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="w">  </span><span class="nv">$aadAppId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'1b730954-1685-4b74-9bfd-dac224a7b894'</span><span class="w">
  </span><span class="nv">$filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"appId eq '</span><span class="nv">$aadAppId</span><span class="s2">' and createdDateTime ge </span><span class="nv">$startDateUTC</span><span class="s2"> and createdDateTime le </span><span class="nv">$endDateUTC</span><span class="s2">"</span><span class="w">
  </span><span class="nv">$uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://graph.microsoft.com/v1.0/auditLogs/signIns?</span><span class="se">`$</span><span class="s2">filter=</span><span class="si">$(</span><span class="w"> </span><span class="p">[</span><span class="n">uri</span><span class="p">]::</span><span class="n">EscapeDataString</span><span class="p">(</span><span class="nv">$filter</span><span class="si">)</span><span class="s2"> )"</span><span class="w">
    
  </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Retrieving sign-in logs for appId '</span><span class="nv">$aadAppId</span><span class="s2">' from </span><span class="nv">$startDate</span><span class="s2"> to </span><span class="nv">$endDate</span><span class="s2">"</span><span class="w">
  </span><span class="nv">$allSignIns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">
  </span><span class="kr">do</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nv">$response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-MgGraphRequest</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">GET</span><span class="w">
      </span><span class="p">}</span><span class="w">
      </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Failed to retrieve sign-in logs: </span><span class="bp">$_</span><span class="s2">"</span><span class="w">
          </span><span class="n">Disconnect-MgGraph</span><span class="w">
          </span><span class="nx">exit</span><span class="w">
      </span><span class="p">}</span><span class="w">
      </span><span class="nv">$allSignIns</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$response</span><span class="o">.</span><span class="nf">value</span><span class="w">
      </span><span class="nv">$uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$response</span><span class="o">.</span><span class="s1">'@odata.nextLink'</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="nv">$uri</span><span class="p">)</span><span class="w">
</span></pre></table></code></div></div></ul><h5 id="data-processing"><span class="me-2"><strong>Data Processing</strong></span><a href="#data-processing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>Extracts relevant details from each sign-in (user, IP, location, status)<li>Supports optional username filtering<li><p>Formats data for reporting</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="w">  </span><span class="nv">$progressCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="nv">$totalCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$allSignIns</span><span class="o">.</span><span class="nf">Count</span><span class="w">
  </span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$allSignIns</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nv">$progressCount</span><span class="o">++</span><span class="w">
      </span><span class="c"># Display progress every 100 items</span><span class="w">
      </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$progressCount</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nv">$percentComplete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">math</span><span class="p">]::</span><span class="n">Round</span><span class="p">((</span><span class="nv">$progressCount</span><span class="w"> </span><span class="n">/</span><span class="w"> </span><span class="nv">$totalCount</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">100</span><span class="p">,</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="w">
          </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Processing: </span><span class="nv">$progressCount</span><span class="s2"> of </span><span class="nv">$totalCount</span><span class="s2"> (</span><span class="nv">$percentComplete</span><span class="s2">%)"</span><span class="w"> </span><span class="nt">-ForegroundColor</span><span class="w"> </span><span class="nx">Cyan</span><span class="w">
      </span><span class="p">}</span><span class="w">
      </span><span class="c"># Create PSCustomObject for each sign-in with the relevant properties</span><span class="w">
      </span><span class="p">[</span><span class="n">PSCustomObject</span><span class="p">]@{</span><span class="w">
          </span><span class="c"># Extracted properties such as UserPrincipalName, CorrelationId</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
    
  </span><span class="c"># Apply username filter if specified</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]::</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="nv">$usernameFilter</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$results</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">UserPrincipalName</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*</span><span class="nv">$usernameFilter</span><span class="s2">*"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div></ul><h5 id="report-generation"><span class="me-2"><strong>Report Generation</strong></span><a href="#report-generation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ul><li>Creates a CSV file for data analysis<li>Generates an interactive HTML report with sortable columns<li><p>Automatically opens the report based on your operating system</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="w">  </span><span class="c"># Export CSV</span><span class="w">
  </span><span class="nv">$csvPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="bp">$PWD</span><span class="w"> </span><span class="s2">"LegacyAzureAD_SignIns_Report.csv"</span><span class="w">
  </span><span class="nv">$results</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Export-Csv</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$csvPath</span><span class="w"> </span><span class="nt">-NoTypeInformation</span><span class="w"> </span><span class="nt">-Encoding</span><span class="w"> </span><span class="nx">UTF8</span><span class="w">
    
  </span><span class="c"># Export HTML with interactive features</span><span class="w">
  </span><span class="nv">$htmlPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="bp">$PWD</span><span class="w"> </span><span class="s2">"LegacyAzureAD_SignIns_Report.html"</span><span class="w">
    
  </span><span class="c"># HTML header with sorting JavaScript</span><span class="w">
  </span><span class="nv">$htmlHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sh">@"&lt;style&gt;
      table {border-width: 1px; border-style: solid; border-color: black; border-collapse: collapse;}
      th {border-width: 1px; padding: 5px; border-style: solid; border-color: black; background-color: #0078D4; color: white; cursor: pointer;}
      td {border-width: 1px; padding: 5px; border-style: solid; border-color: black;}
      .sorted-asc::after { content: " ▲"; }
      .sorted-desc::after { content: " ▼"; }
      tr:nth-child(even) {background-color: #f2f2f2;}
      tr:hover {background-color: #ddd;}
  &lt;/style&gt;
  &lt;script&gt;
  function sortTable(n) {
    // Sorting logic for table columns
    // ...
  }
  &lt;/script&gt;
  "@</span><span class="w">
    
  </span><span class="c"># Open HTML report based on platform</span><span class="w">
  </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$IsWindows</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">OS</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'Windows'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="n">Start-Process</span><span class="w"> </span><span class="nv">$htmlPath</span><span class="w">
      </span><span class="p">}</span><span class="w">
      </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="bp">$IsMacOS</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="p">(</span><span class="n">uname</span><span class="p">)</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'Darwin'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="n">Invoke-Expression</span><span class="w"> </span><span class="s2">"open '</span><span class="nv">$htmlPath</span><span class="s2">'"</span><span class="w">
      </span><span class="p">}</span><span class="w">
      </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="bp">$IsLinux</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="p">(</span><span class="n">uname</span><span class="p">)</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'Linux'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="n">Invoke-Expression</span><span class="w"> </span><span class="s2">"xdg-open '</span><span class="nv">$htmlPath</span><span class="s2">'"</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">Write-Warning</span><span class="w"> </span><span class="s2">"Could not automatically open the report: </span><span class="bp">$_</span><span class="s2">"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div></ul><h2 id="the-full-powershell-script"><span class="me-2">The Full PowerShell Script</span><a href="#the-full-powershell-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Here’s the complete PowerShell script, you can copy and save it or find the current version on GitHub at <a href="https://github.com/cocallaw/Entra-AAD-PS-Retirement/">cocallaw/Entra-AAD-PS-Retirement</a>.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
</pre><td class="rouge-code"><pre><span class="kr">function</span><span class="w"> </span><span class="nf">Get-ValidatedDate</span><span class="p">(</span><span class="nv">$prompt</span><span class="p">,</span><span class="w"> </span><span class="nv">$default</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">do</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$inDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="nv">$prompt</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">([</span><span class="n">string</span><span class="p">]::</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="nv">$inDate</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="nv">$default</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="nv">$parsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="w">
        </span><span class="nv">$valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">datetime</span><span class="p">]::</span><span class="n">TryParseExact</span><span class="p">(</span><span class="nv">$inDate</span><span class="p">,</span><span class="w"> </span><span class="s1">'yyyy-MM-dd'</span><span class="p">,</span><span class="w"> </span><span class="bp">$null</span><span class="p">,</span><span class="w"> </span><span class="s1">'None'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">ref</span><span class="p">]</span><span class="nv">$parsed</span><span class="p">)</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$valid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="nv">$parsed</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="n">Write-Warning</span><span class="w"> </span><span class="s2">"Invalid date format. Please use yyyy-MM-dd."</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="bp">$true</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$InformationPreference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'SilentlyContinue'</span><span class="w">
</span><span class="nv">$WarningPreference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'SilentlyContinue'</span><span class="w"> </span><span class="c"># Suppress warnings globally</span><span class="w">

</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Starting Legacy Azure AD PowerShell Sign-In Report script"</span><span class="w">
</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Checking prerequisites"</span><span class="w">

</span><span class="c"># Check if Microsoft Graph commands are available</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Command</span><span class="w"> </span><span class="nx">Get-MgContext</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c"># Only then check if module is installed</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Module</span><span class="w"> </span><span class="nt">-ListAvailable</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Microsoft.Graph</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$WarningPreference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Continue'</span><span class="w"> </span><span class="c"># Temporarily restore warnings for important messages</span><span class="w">
        </span><span class="n">Write-Warning</span><span class="w"> </span><span class="s2">"Microsoft.Graph module is not installed. Please install it using: Install-Module Microsoft.Graph -Scope CurrentUser"</span><span class="w">
        </span><span class="kr">exit</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="c"># Module is installed but commands aren't available, so try to load it silently</span><span class="w">
    </span><span class="nv">$oldWarningPreference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$WarningPreference</span><span class="w">
    </span><span class="nv">$WarningPreference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'SilentlyContinue'</span><span class="w"> </span><span class="c"># Suppress warnings during module import</span><span class="w">
    </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c"># Try minimal import</span><span class="w">
        </span><span class="n">Import-Module</span><span class="w"> </span><span class="nx">Microsoft.Graph.Authentication</span><span class="w"> </span><span class="nt">-DisableNameChecking</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Command</span><span class="w"> </span><span class="nx">Get-MgContext</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="c"># Try full module import with all error suppression flags</span><span class="w">
            </span><span class="n">Import-Module</span><span class="w"> </span><span class="nx">Microsoft.Graph</span><span class="w"> </span><span class="nt">-SkipEditionCheck</span><span class="w"> </span><span class="nt">-DisableNameChecking</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c"># Silently ignore errors - we'll check command availability instead</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="nv">$WarningPreference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$oldWarningPreference</span><span class="w">
    </span><span class="c"># Verify everything loaded correctly</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Command</span><span class="w"> </span><span class="nx">Get-MgContext</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Failed to load Microsoft Graph commands. Please start with a fresh PowerShell session."</span><span class="w">
        </span><span class="kr">exit</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Microsoft Graph commands are available"</span><span class="w">

</span><span class="nv">$requiredScopes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="s2">"AuditLog.Read.All"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Directory.Read.All"</span><span class="p">,</span><span class="w"> </span><span class="s2">"IdentityRiskEvent.Read.All"</span><span class="p">)</span><span class="w">
</span><span class="nv">$needConnect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Get-MgContext</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Connecting to Microsoft Graph..."</span><span class="w">
    </span><span class="nv">$needConnect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$currentScopes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Get-MgContext</span><span class="p">)</span><span class="o">.</span><span class="nf">Scopes</span><span class="w">
    </span><span class="nx">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$currentScopes</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="p">(</span><span class="nv">$requiredScopes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="nt">-notin</span><span class="w"> </span><span class="nv">$currentScopes</span><span class="w"> </span><span class="p">}))</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Existing session missing required scopes. Reconnecting..."</span><span class="w">
        </span><span class="nv">$needConnect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Already connected to Microsoft Graph. Reusing existing session."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$needConnect</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Connect-MgGraph</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w"> </span><span class="nv">$requiredScopes</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Prompt date range, defaulting to 30 days</span><span class="w">
</span><span class="nv">$startDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ValidatedDate</span><span class="w"> </span><span class="s2">"Enter start date (yyyy-MM-dd), or press Enter for 30 days ago"</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Date</span><span class="p">)</span><span class="o">.</span><span class="nf">AddDays</span><span class="p">(</span><span class="nt">-30</span><span class="p">)</span><span class="w">
</span><span class="nv">$endDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ValidatedDate</span><span class="w"> </span><span class="s2">"Enter end date (yyyy-MM-dd), or press Enter for today"</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Date</span><span class="p">)</span><span class="w">
</span><span class="c"># Prompt username filter (optional)</span><span class="w">
</span><span class="nv">$usernameFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Enter username filter (optional), or press Enter to skip"</span><span class="w">
</span><span class="nv">$aadAppId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'1b730954-1685-4b74-9bfd-dac224a7b894'</span><span class="w">

</span><span class="nv">$startDateUTC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">datetime</span><span class="p">]::</span><span class="n">Parse</span><span class="p">(</span><span class="nv">$startDate</span><span class="p">)</span><span class="o">.</span><span class="nf">ToUniversalTime</span><span class="p">()</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s2">"yyyy-MM-ddTHH:mm:ssZ"</span><span class="p">)</span><span class="w">
</span><span class="nv">$endDateUTC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">([</span><span class="n">datetime</span><span class="p">]::</span><span class="n">Parse</span><span class="p">(</span><span class="nv">$endDate</span><span class="p">)</span><span class="o">.</span><span class="nf">AddDays</span><span class="p">(</span><span class="nx">1</span><span class="p">)</span><span class="o">.</span><span class="nf">AddSeconds</span><span class="p">(</span><span class="nt">-1</span><span class="p">))</span><span class="o">.</span><span class="nf">ToUniversalTime</span><span class="p">()</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s2">"yyyy-MM-ddTHH:mm:ssZ"</span><span class="p">)</span><span class="w">

</span><span class="nv">$filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"appId eq '</span><span class="nv">$aadAppId</span><span class="s2">' and createdDateTime ge </span><span class="nv">$startDateUTC</span><span class="s2"> and createdDateTime le </span><span class="nv">$endDateUTC</span><span class="s2">"</span><span class="w">
</span><span class="nv">$uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://graph.microsoft.com/v1.0/auditLogs/signIns?</span><span class="se">`$</span><span class="s2">filter=</span><span class="si">$(</span><span class="w"> </span><span class="p">[</span><span class="n">uri</span><span class="p">]::</span><span class="n">EscapeDataString</span><span class="p">(</span><span class="nv">$filter</span><span class="si">)</span><span class="s2"> )"</span><span class="w">

</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Retrieving sign-in logs for appId '</span><span class="nv">$aadAppId</span><span class="s2">' from </span><span class="nv">$startDate</span><span class="s2"> to </span><span class="nv">$endDate</span><span class="s2">"</span><span class="w">
</span><span class="nv">$allSignIns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">
</span><span class="kr">do</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-MgGraphRequest</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">GET</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Failed to retrieve sign-in logs: </span><span class="bp">$_</span><span class="s2">"</span><span class="w">
        </span><span class="n">Disconnect-MgGraph</span><span class="w">
        </span><span class="nx">exit</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="nv">$allSignIns</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$response</span><span class="o">.</span><span class="nf">value</span><span class="w">
    </span><span class="nv">$uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$response</span><span class="o">.</span><span class="s1">'@odata.nextLink'</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="nv">$uri</span><span class="p">)</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$allSignIns</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Warning</span><span class="w"> </span><span class="s2">"No sign-in logs found for the specified filters."</span><span class="w">
    </span><span class="n">Disconnect-MgGraph</span><span class="w">
    </span><span class="nx">exit</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Retrieved </span><span class="si">$(</span><span class="nv">$allSignIns</span><span class="o">.</span><span class="nf">Count</span><span class="si">)</span><span class="s2"> sign-in logs for appId '</span><span class="nv">$aadAppId</span><span class="s2">' from </span><span class="nv">$startDate</span><span class="s2"> to </span><span class="nv">$endDate</span><span class="s2">"</span><span class="w">
</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Processing sign-in logs"</span><span class="w">
</span><span class="nv">$progressCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="nv">$totalCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$allSignIns</span><span class="o">.</span><span class="nf">Count</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$allSignIns</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$progressCount</span><span class="o">++</span><span class="w">
    </span><span class="c"># Display progress every 100 items</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$progressCount</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$percentComplete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">math</span><span class="p">]::</span><span class="n">Round</span><span class="p">((</span><span class="nv">$progressCount</span><span class="w"> </span><span class="n">/</span><span class="w"> </span><span class="nv">$totalCount</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">100</span><span class="p">,</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="w">
        </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Processing: </span><span class="nv">$progressCount</span><span class="s2"> of </span><span class="nv">$totalCount</span><span class="s2"> (</span><span class="nv">$percentComplete</span><span class="s2">%)"</span><span class="w"> </span><span class="nt">-ForegroundColor</span><span class="w"> </span><span class="nx">Cyan</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="p">[</span><span class="n">PSCustomObject</span><span class="p">]@{</span><span class="w">
        </span><span class="nx">UserPrincipalName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="err">.</span><span class="nx">userPrincipalName</span><span class="w">
        </span><span class="nx">AppDisplayName</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="err">.</span><span class="nx">appDisplayName</span><span class="w">
        </span><span class="nx">IPAddress</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="err">.</span><span class="nx">ipAddress</span><span class="w">
        </span><span class="nx">Location</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="err">((</span><span class="bp">$_</span><span class="err">.</span><span class="nx">location</span><span class="err">.</span><span class="nx">city</span><span class="p">,</span><span class="w"> </span><span class="bp">$_</span><span class="err">.</span><span class="nx">location</span><span class="err">.</span><span class="nx">state</span><span class="p">,</span><span class="w"> </span><span class="bp">$_</span><span class="err">.</span><span class="nx">location</span><span class="err">.</span><span class="nx">countryOrRegion</span><span class="err">)</span><span class="w"> </span><span class="err">-</span><span class="nx">join</span><span class="w"> </span><span class="s2">", "</span><span class="err">).</span><span class="nx">Trim</span><span class="err">(</span><span class="s1">', '</span><span class="err">)</span><span class="w">
        </span><span class="nx">SignInTime</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="err">.</span><span class="nx">createdDateTime</span><span class="w">
        </span><span class="nx">Status</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nx">if</span><span class="w"> </span><span class="err">(</span><span class="bp">$_</span><span class="err">.</span><span class="nx">status</span><span class="err">.</span><span class="nx">errorCode</span><span class="w"> </span><span class="err">-</span><span class="nx">eq</span><span class="w"> </span><span class="mi">0</span><span class="err">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">'Success'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nx">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">'Failure'</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="nx">RiskLevel</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="err">.</span><span class="nx">riskLevelAggregated</span><span class="w">
        </span><span class="nx">CorrelationId</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="err">.</span><span class="nx">correlationId</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Processing complete: </span><span class="nv">$totalCount</span><span class="s2"> items processed"</span><span class="w"> </span><span class="nt">-ForegroundColor</span><span class="w"> </span><span class="nx">Green</span><span class="w">

</span><span class="c"># Apply username filter if specified</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">]::</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="nv">$usernameFilter</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$results</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">UserPrincipalName</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*</span><span class="nv">$usernameFilter</span><span class="s2">*"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$results</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Warning</span><span class="w"> </span><span class="s2">"No sign-in logs match the username filter."</span><span class="w">
    </span><span class="n">Disconnect-MgGraph</span><span class="w">
    </span><span class="nx">exit</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Export CSV</span><span class="w">
</span><span class="nv">$csvPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="bp">$PWD</span><span class="w"> </span><span class="s2">"LegacyAzureAD_SignIns_Report.csv"</span><span class="w">
</span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$results</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Export-Csv</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$csvPath</span><span class="w"> </span><span class="nt">-NoTypeInformation</span><span class="w"> </span><span class="nt">-Encoding</span><span class="w"> </span><span class="nx">UTF8</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"CSV report saved to: </span><span class="nv">$csvPath</span><span class="s2">"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Error</span><span class="w"> </span><span class="s2">"Failed to export CSV file: </span><span class="bp">$_</span><span class="s2">"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Export HTML</span><span class="w">
</span><span class="nv">$htmlPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Join-Path</span><span class="w"> </span><span class="bp">$PWD</span><span class="w"> </span><span class="s2">"LegacyAzureAD_SignIns_Report.html"</span><span class="w">

</span><span class="nv">$htmlHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sh">@"
&lt;style&gt;
    table {border-width: 1px; border-style: solid; border-color: black; border-collapse: collapse;}
    th {border-width: 1px; padding: 5px; border-style: solid; border-color: black; background-color: #0078D4; color: white; cursor: pointer;}
    td {border-width: 1px; padding: 5px; border-style: solid; border-color: black;}
    .sorted-asc::after { content: " ▲"; }
    .sorted-desc::after { content: " ▼"; }
    tr:nth-child(even) {background-color: #f2f2f2;}
    tr:hover {background-color: #ddd;}
&lt;/style&gt;
&lt;title&gt;Legacy Azure AD PowerShell Sign-In Report - </span><span class="si">$(</span><span class="nv">$startDate</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s1">'yyyy-MM-dd'</span><span class="p">)</span><span class="sh">) to </span><span class="si">$(</span><span class="nv">$endDate</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s1">'yyyy-MM-dd'</span><span class="p">)</span><span class="sh">)&lt;/title&gt;
&lt;script&gt;
function sortTable(n) {
  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
  table = document.getElementsByTagName("table")[0];
  switching = true;
  // Set the sorting direction to ascending:
  dir = "asc";
  
  // Remove sort indicators from all headers
  var headers = table.getElementsByTagName("th");
  for (i = 0; i &lt; headers.length; i++) {
    headers[i].classList.remove("sorted-asc", "sorted-desc");
  }
  
  /* Make a loop that will continue until no switching has been done: */
  while (switching) {
    switching = false;
    rows = table.rows;
    /* Loop through all table rows (except the first, which contains table headers): */
    for (i = 1; i &lt; (rows.length - 1); i++) {
      shouldSwitch = false;
      /* Get the two elements you want to compare, one from current row and one from the next: */
      x = rows[i].getElementsByTagName("TD")[n];
      y = rows[i + 1].getElementsByTagName("TD")[n];
      
      if (!x || !y) continue;
      
      // Check if the two rows should switch place:
      if (dir == "asc") {
        if (isDate(x.innerHTML) &amp;&amp; isDate(y.innerHTML)) {
          if (new Date(x.innerHTML) &gt; new Date(y.innerHTML)) {
            shouldSwitch = true;
            break;
          }
        } else {
          if (x.innerHTML.toLowerCase() &gt; y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        }
      } else if (dir == "desc") {
        if (isDate(x.innerHTML) &amp;&amp; isDate(y.innerHTML)) {
          if (new Date(x.innerHTML) &lt; new Date(y.innerHTML)) {
            shouldSwitch = true;
            break;
          }
        } else {
          if (x.innerHTML.toLowerCase() &lt; y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        }
      }
    }
    if (shouldSwitch) {
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      switchcount++;
    } else {
      if (switchcount == 0 &amp;&amp; dir == "asc") {
        dir = "desc";
        switching = true;
      }
    }
  }
  
  // Add sort indicator to the clicked header
  headers[n].classList.add(dir === "asc" ? "sorted-asc" : "sorted-desc");
}

// Helper function to detect dates
function isDate(value) {
  // Simple date detection for common formats
  const datePattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}|^\d{1,2}\/\d{1,2}\/\d{4}/;
  return datePattern.test(value);
}
&lt;/script&gt;
&lt;h1&gt;Legacy Azure AD PowerShell Sign-In Report&lt;/h1&gt;
&lt;p&gt;Report generated: </span><span class="si">$(</span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-Format</span><span class="w"> </span><span class="s2">"yyyy-MM-dd HH:mm"</span><span class="p">)</span><span class="sh">&lt;/p&gt;
&lt;p&gt;Date range: </span><span class="si">$(</span><span class="nv">$startDate</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s1">'yyyy-MM-dd'</span><span class="p">)</span><span class="sh">) to </span><span class="si">$(</span><span class="nv">$endDate</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s1">'yyyy-MM-dd'</span><span class="p">)</span><span class="sh">)&lt;/p&gt;
"@</span><span class="w">

</span><span class="c"># Generate HTML without the replacement logic first</span><span class="w">
</span><span class="nv">$preContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$htmlHeader</span><span class="w">
</span><span class="nv">$postContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;p&gt;&lt;em&gt;Click on column headers to sort&lt;/em&gt;&lt;/p&gt;"</span><span class="w">

</span><span class="c"># Generate basic HTML</span><span class="w">
</span><span class="nv">$html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$results</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertTo-Html</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">UserPrincipalName</span><span class="p">,</span><span class="w"> </span><span class="nx">AppDisplayName</span><span class="p">,</span><span class="w"> </span><span class="nx">IPAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">Location</span><span class="p">,</span><span class="w"> </span><span class="nx">SignInTime</span><span class="p">,</span><span class="w"> </span><span class="nx">Status</span><span class="p">,</span><span class="w"> </span><span class="nx">RiskLevel</span><span class="p">,</span><span class="w"> </span><span class="nx">CorrelationId</span><span class="w"> </span><span class="nt">-PreContent</span><span class="w"> </span><span class="nv">$preContent</span><span class="w"> </span><span class="nt">-PostContent</span><span class="w"> </span><span class="nv">$postContent</span><span class="w">

</span><span class="c"># Create a more reliable method to replace the header names and add onclick handlers</span><span class="w">
</span><span class="nv">$columnOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="s1">'UserPrincipalName'</span><span class="p">,</span><span class="w"> </span><span class="s1">'AppDisplayName'</span><span class="p">,</span><span class="w"> </span><span class="s1">'IPAddress'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Location'</span><span class="p">,</span><span class="w"> </span><span class="s1">'SignInTime'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Status'</span><span class="p">,</span><span class="w"> </span><span class="s1">'RiskLevel'</span><span class="p">,</span><span class="w"> </span><span class="s1">'CorrelationId'</span><span class="p">)</span><span class="w">
</span><span class="nv">$headerDisplayNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{</span><span class="w">
    </span><span class="s1">'UserPrincipalName'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'User Principal Name'</span><span class="w">
    </span><span class="s1">'AppDisplayName'</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s1">'App Display Name'</span><span class="w">
    </span><span class="s1">'IPAddress'</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s1">'IP Address'</span><span class="w">
    </span><span class="s1">'Location'</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s1">'Location'</span><span class="w">
    </span><span class="s1">'SignInTime'</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s1">'Sign-In Time'</span><span class="w">
    </span><span class="s1">'Status'</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s1">'Status'</span><span class="w">
    </span><span class="s1">'RiskLevel'</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s1">'Risk Level'</span><span class="w">
    </span><span class="s1">'CorrelationId'</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s1">'Correlation ID'</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Process the header row directly using a more reliable HTML parsing approach</span><span class="w">
</span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="nv">$i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="nv">$columnOrder</span><span class="o">.</span><span class="nf">Count</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$colName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$columnOrder</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="w">
    </span><span class="nv">$displayName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$headerDisplayNames</span><span class="p">[</span><span class="nv">$colName</span><span class="p">]</span><span class="w">
    </span><span class="nv">$oldHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;th&gt;</span><span class="nv">$colName</span><span class="s2">&lt;/th&gt;"</span><span class="w">
    </span><span class="nv">$newHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;th onclick=""sortTable(</span><span class="nv">$i</span><span class="s2">)""&gt;</span><span class="nv">$displayName</span><span class="s2">&lt;/th&gt;"</span><span class="w">
    </span><span class="nv">$html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$html</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="p">[</span><span class="n">regex</span><span class="p">]::</span><span class="n">Escape</span><span class="p">(</span><span class="nv">$oldHeader</span><span class="p">),</span><span class="w"> </span><span class="nv">$newHeader</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Save the HTML file</span><span class="w">
</span><span class="nv">$html</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-Content</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$htmlPath</span><span class="w">

</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"HTML report saved to: </span><span class="nv">$htmlPath</span><span class="s2">"</span><span class="w">

</span><span class="c"># Open HTML report based on platform</span><span class="w">
</span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$IsWindows</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">OS</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'Windows'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Start-Process</span><span class="w"> </span><span class="nv">$htmlPath</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="bp">$IsMacOS</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="p">(</span><span class="n">uname</span><span class="p">)</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'Darwin'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Invoke-Expression</span><span class="w"> </span><span class="s2">"open '</span><span class="nv">$htmlPath</span><span class="s2">'"</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="bp">$IsLinux</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="p">(</span><span class="n">uname</span><span class="p">)</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s1">'Linux'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Invoke-Expression</span><span class="w"> </span><span class="s2">"xdg-open '</span><span class="nv">$htmlPath</span><span class="s2">'"</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Information</span><span class="w"> </span><span class="s2">"HTML report saved to: </span><span class="nv">$htmlPath</span><span class="s2"> (please open manually)"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Warning</span><span class="w"> </span><span class="s2">"Could not automatically open the report: </span><span class="bp">$_</span><span class="s2">"</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"HTML report saved to: </span><span class="nv">$htmlPath</span><span class="s2"> (please open manually)"</span><span class="w">
</span><span class="p">}</span><span class="w">


</span></pre></table></code></div></div><h2 id="final-recommendations"><span class="me-2">Final Recommendations</span><a href="#final-recommendations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Identify remaining users/scripts using the legacy modules now.<li>Continue to use sign-in log reports to monitor usage burn down or unauthorized usage leading up to the future retirement date.<li>Begin migrating those to <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/overview?view=graph-powershell-1.0">Microsoft Graph PowerShell</a> or <a href="https://learn.microsoft.com/en-us/powershell/entra-powershell/overview?view=entra-powershell">Microsoft Entra PowerShell</a>.</ul><h2 id="additional-resources"><span class="me-2">Additional Resources</span><a href="#additional-resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://www.powershellgallery.com/packages/AzureAD/2.0.2.182">PowerShell Gallery: AzureAD Module</a><li><a href="https://learn.microsoft.com/powershell/microsoftgraph/">Microsoft Graph PowerShell SDK</a><li><a href="https://learn.microsoft.com/en-us/powershell/entra-powershell/overview?view=entra-powershell">Microsoft Entra PowerShell</a>.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/azure/">Azure</a>, <a href="/categories/powershell/">PowerShell</a>, <a href="/categories/entra/">Entra</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/azuread/" class="post-tag no-text-decoration" >AzureAD</a> <a href="/tags/microsoft-graph/" class="post-tag no-text-decoration" >Microsoft Graph</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >PowerShell</a> <a href="/tags/entra-id/" class="post-tag no-text-decoration" >Entra ID</a> <a href="/tags/reporting/" class="post-tag no-text-decoration" >Reporting</a> <a href="/tags/security/" class="post-tag no-text-decoration" >Security</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fcocallaw.com%2Fposts%2FIdentify-Legacy-AAD-PS-Users%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fcocallaw.com%2Fposts%2FIdentify-Legacy-AAD-PS-Users%2F&title=Identify%20AzureAD%20PowerShell%20Users%20in%20your%20Tenant%20before%20Retirement%20-%20cocallaw" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Reddit" aria-label="Reddit"> <i class="fa-fw fa-brands fa-square-reddit"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Identify%20AzureAD%20PowerShell%20Users%20in%20your%20Tenant%20before%20Retirement%20-%20cocallaw&u=https%3A%2F%2Fcocallaw.com%2Fposts%2FIdentify-Legacy-AAD-PS-Users%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.threads.net/intent/post?text=Identify%20AzureAD%20PowerShell%20Users%20in%20your%20Tenant%20before%20Retirement%20-%20cocallaw%20https%3A%2F%2Fcocallaw.com%2Fposts%2FIdentify-Legacy-AAD-PS-Users%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Threads" aria-label="Threads"> <i class="fa-fw fa-brands fa-square-threads"></i> </a> <a href="https://bsky.app/intent/compose?text=Identify%20AzureAD%20PowerShell%20Users%20in%20your%20Tenant%20before%20Retirement%20-%20cocallaw%20https%3A%2F%2Fcocallaw.com%2Fposts%2FIdentify-Legacy-AAD-PS-Users%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Bluesky" aria-label="Bluesky"> <i class="fa-fw fa-brands fa-bluesky"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/Deploying-AVD-with-Bicep/">Deploying AVD and retrieving the Registration Token with Bicep</a><li class="text-truncate lh-lg"> <a href="/posts/Identify-Legacy-AAD-PS-Users/">Identify AzureAD PowerShell Users in your Tenant before Retirement</a><li class="text-truncate lh-lg"> <a href="/posts/Export-Bitlocker-Keys-from-Entra/">Export BitLocker Keys from Entra with Graph PowerShell</a><li class="text-truncate lh-lg"> <a href="/posts/Automating-Container-Builds-for-Upstream-Changes/">Automating Container Builds with GitHub Actions for Upstream Changes</a><li class="text-truncate lh-lg"> <a href="/posts/Creating-Confidentail-Compute-Images-from-CVMs/">Create Confidential Compute Capable Custom Images from Windows CVMs</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/images/">images</a> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft-graph/">Microsoft Graph</a> <a class="post-tag btn btn-outline-primary" href="/tags/powershell/">PowerShell</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">Automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/avd/">AVd</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure-virtual-desktop/">Azure Virtual Desktop</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure/">Azure</a> <a class="post-tag btn btn-outline-primary" href="/tags/azuread/">AzureAD</a> <a class="post-tag btn btn-outline-primary" href="/tags/bicep/">Bicep</a> <a class="post-tag btn btn-outline-primary" href="/tags/bitlocker/">BitLocker</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/Export-Bitlocker-Keys-from-Entra/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1747044000" data-df="ll" > May 12, 2025 </time><h4 class="pt-0 my-2">Export BitLocker Keys from Entra with Graph PowerShell</h4><div class="text-muted"><p>How to retrieve BitLocker recovery keys from Entra using PowerShell and Microsoft Graph.</p></div></div></a></article><article class="col"> <a href="/posts/Deploying-AVD-with-Bicep/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1750093200" data-df="ll" > Jun 16, 2025 </time><h4 class="pt-0 my-2">Deploying AVD and retrieving the Registration Token with Bicep</h4><div class="text-muted"><p>Learn how to deploy AVD resources using Azure Bicep and retrieve the Host Pool registration token during the deployment to simplify the process.</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/Export-Bitlocker-Keys-from-Entra/" class="btn btn-outline-primary" aria-label="Older" ><p>Export BitLocker Keys from Entra with Graph PowerShell</p></a> <a href="/posts/Deploying-AVD-with-Bicep/" class="btn btn-outline-primary" aria-label="Newer" ><p>Deploying AVD and retrieving the Registration Token with Bicep</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/username">Corey Callaway</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.3.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/images/">images</a> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft-graph/">Microsoft Graph</a> <a class="post-tag btn btn-outline-primary" href="/tags/powershell/">PowerShell</a> <a class="post-tag btn btn-outline-primary" href="/tags/automation/">Automation</a> <a class="post-tag btn btn-outline-primary" href="/tags/avd/">AVd</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure-virtual-desktop/">Azure Virtual Desktop</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure/">Azure</a> <a class="post-tag btn btn-outline-primary" href="/tags/azuread/">AzureAD</a> <a class="post-tag btn btn-outline-primary" href="/tags/bicep/">Bicep</a> <a class="post-tag btn btn-outline-primary" href="/tags/bitlocker/">BitLocker</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'cocallaw/cocallaw.github.io', 'data-repo-id': 'R_kgDOMuW1lg', 'data-category': 'Giscus', 'data-category-id': 'DIC_kwDOMuW1ls4CjqPh', 'data-mapping': 'pathname', 'data-strict' : '0', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
